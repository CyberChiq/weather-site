<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Desert Viber ‚Äî Live US Radar & NWS Alerts</title>

  <!-- Leaflet CSS -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" rel="stylesheet">

  <!-- YouTube Subscribe widget -->
  <script async defer src="https://apis.google.com/js/platform.js"></script>

  <!-- Social share / SEO -->
  <meta name="description" content="Live US radar & NWS alerts + real-time severe weather coverage on YouTube. Subscribe to Desert Viber!" />
  <meta property="og:title" content="Desert Viber ‚Äî Live US Weather Radar & Alerts" />
  <meta property="og:description" content="Interactive radar, live alerts, and a 24/7 weather stream. Subscribe to support the channel!" />
  <meta property="og:type" content="website" />
  <meta name="twitter:card" content="summary_large_image" />

  <style>
    :root { --bg:#0b0d12; --fg:#f2f5f9; --muted:#9aa4b2; --accent:#49a6ff; --danger:#ff4d4f; }
    body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto; background:var(--bg); color:var(--fg); }
    header { padding:16px 20px; display:flex; gap:12px; flex-wrap:wrap; align-items:center; justify-content:space-between; border-bottom:1px solid #1a222f; }
    .brand { font-weight:700; letter-spacing:.3px; display:flex; align-items:center; gap:10px; }
    .cta { display:flex; gap:8px; flex-wrap:wrap; }
    .btn { background:#141a24; color:var(--fg); border:1px solid #1f2a3a; padding:8px 12px; border-radius:8px; text-decoration:none; cursor:pointer; }
    .btn.accent { border-color: var(--accent); }
    .btn.danger { border-color: var(--danger); }
    .grid { display:grid; grid-template-columns: 1fr; gap:16px; padding:16px; }
    @media(min-width: 980px){ .grid { grid-template-columns: 2fr 1fr; } }
    .card { background:#0f141d; border:1px solid #182233; border-radius:12px; overflow:hidden; }
    .card h2 { margin:0; padding:12px 14px; font-size:1rem; border-bottom:1px solid #182233; color:#e8eef7; }
    .video-wrap { position:relative; padding-top:56.25%; }
    .video-wrap iframe { position:absolute; inset:0; width:100%; height:100%; border:0; }
    #map { width:100%; height:560px; }
    .panel { padding:12px 14px; }
    .muted { color:var(--muted); font-size:.9rem; }
    .alerts-list { display:flex; flex-direction:column; gap:10px; max-height:520px; overflow:auto; padding:12px; }
    .alert { border:1px solid #24334a; border-left:4px solid var(--danger); border-radius:8px; padding:10px 12px; background:#0d131b; }
    .alert-title { font-weight:600; }
    .controls { display:flex; gap:8px; flex-wrap:wrap; margin:10px 0 0; }
    input, select { background:#0b1118; color:var(--fg); border:1px solid #1f2a3a; border-radius:8px; padding:8px 10px; }
    .legend { position:absolute; bottom:12px; right:12px; background:#0b1118cc; color:#e8eef7; padding:8px 10px; border-radius:8px; border:1px solid #1f2a3a; font-size:.85rem; }
    .attribution { padding:10px 14px; font-size:.8rem; color:var(--muted); border-top:1px solid #182233; }

    /* Sticky subscribe bar */
    .subbar{position:sticky;top:0;z-index:999;background:#0b1118;border-bottom:1px solid #1f2a3a;padding:8px 12px;display:flex;gap:12px;align-items:center;justify-content:center}
    .subbar .note{color:#c6d0de;font-size:.9rem}

    /* Subscribe Gate (visibility controlled by class) */
    .gate-overlay{display:none; position:fixed; inset:0; background:rgba(5,8,12,.86); align-items:center; justify-content:center; z-index:9999}
    .gate-overlay.is-open{display:flex}
    .gate-modal{width:min(680px,92vw);background:#0f141d;border:1px solid #1f2a3a;border-radius:14px;box-shadow:0 10px 38px rgba(0,0,0,.45);padding:22px}
    .gate-modal h3{margin:0 0 8px;font-size:1.25rem;color:#e8eef7}
    .gate-modal p{margin:0 0 14px;color:#c6d0de}
    .gate-actions{display:flex;gap:10px;align-items:center;margin-top:14px;flex-wrap:wrap}
    .gate-btn{background:#141a24;color:#f2f5f9;border:1px solid #1f2a3a;padding:10px 14px;border-radius:10px;cursor:pointer;text-decoration:none}
    .gate-btn.primary{border-color:var(--accent)}
    body.gated{overflow:hidden}
    main.gated,header.gated{pointer-events:none;user-select:none;filter:blur(1px)}

    /* Utils */
    .list-clean {list-style:none; padding-left:0; margin:0; display:grid; gap:8px}
    .pill {display:inline-block; padding:4px 10px; border:1px solid #24334a; border-radius:999px; font-size:.85rem; color:#c6d0de}
  </style>
</head>
<body>

  <!-- Subscribe Gate -->
  <div id="subGate" class="gate-overlay" role="dialog" aria-modal="true" aria-labelledby="gateTitle" aria-describedby="gateDesc">
    <div class="gate-modal">
      <h3 id="gateTitle">Support the Stream ‚Äî Subscribe to Desert Viber</h3>
      <p id="gateDesc">This project runs on your support. Tap subscribe below, then continue to the live radar & alerts.</p>

      <div class="g-ytsubscribe" data-channel="@DesertViber" data-layout="full" data-theme="dark" data-count="default"></div>

      <div class="gate-actions">
        <a class="gate-btn" href="https://www.youtube.com/@DesertViber" target="_blank" rel="noopener">Open channel</a>
        <button class="gate-btn primary" id="continueBtn" type="button">I Subscribed ‚Äî Continue</button>
      </div>
      <p class="muted" style="margin-top:8px;">(We can‚Äôt verify a subscription without Google sign-in, but subscribing here or on YouTube helps a lot. Thank you!)</p>
      <ul class="list-clean" style="margin-top:10px;">
        <li><span class="pill">No spam. Just weather.</span> <span class="pill">Family-friendly stream</span> <span class="pill">Real-time alerts</span></li>
      </ul>
    </div>
  </div>

  <header>
    <div class="brand">
      <img src="logo.png" alt="Desert Viber logo" style="width:34px;height:34px;border-radius:8px;border:1px solid #1f2a3a;object-fit:cover;">
      <span>Desert Viber ‚Äî Live Radar & Alerts</span>
    </div>
    <div class="cta">
      <a class="btn accent" href="https://www.youtube.com/@DesertViber" target="_blank" rel="noopener">Watch on YouTube</a>
      <a class="btn" href="#alerts">View Alerts</a>
      <a class="btn danger" href="#support">Support the Stream</a>
    </div>
  </header>

  <!-- Sticky subscribe bar -->
  <div class="subbar">
    <span class="note">Enjoying the radar & alerts? Subscribe to support the channel:</span>
    <div class="g-ytsubscribe" data-channel="@DesertViber" data-layout="default" data-theme="dark" data-count="default"></div>
    <a class="btn accent" href="https://www.youtube.com/@DesertViber" target="_blank" rel="noopener">Open Channel</a>
  </div>

  <main class="grid">
    <section class="card">
      <h2>Live Stream</h2>
      <div class="video-wrap">
        <iframe
          src="https://www.youtube.com/embed/rivJ9lgNZU8?autoplay=0&modestbranding=1&rel=0"
          title="YouTube live"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          allowfullscreen></iframe>
      </div>
      <div class="attribution">
        Tip: click ‚ÄúView Alerts‚Äù to see active NWS alerts and pan the map to your area.
      </div>
    </section>

    <aside class="card" id="alerts">
      <h2>Active Weather Alerts (NWS)</h2>
      <div class="panel">
        <div class="muted">Filter by your area:</div>
        <div class="controls">
          <input id="zip" placeholder="ZIP code (e.g., 80903)" />
          <button class="btn" id="locate">Use my location</button>
          <button class="btn" id="applyZip">Go</button>
        </div>
      </div>
      <div class="alerts-list" id="alertsList">
        <div class="muted">Loading alerts‚Ä¶</div>
      </div>
      <div class="attribution">
        Alerts: National Weather Service API ‚Ä¢ Radar: RainViewer tiles ‚Ä¢ Map: ¬© OpenStreetMap contributors
      </div>
    </aside>

    <section class="card" style="grid-column: 1 / -1;">
      <h2>Interactive Radar</h2>

      <!-- Region jump buttons -->
      <div class="panel" style="display:flex;gap:8px;flex-wrap:wrap;align-items:center;">
        <span class="muted">Quick view:</span>
        <button class="btn" data-view="west">West</button>
        <button class="btn" data-view="central">Central</button>
        <button class="btn" data-view="east">East</button>
        <button class="btn" data-view="alaska">Alaska</button>
        <button class="btn" data-view="hawaii">Hawaii</button>
      </div>

      <div id="map"></div>
      <div class="legend">Radar intensity ‚Üë ‚Ä¢ Use pinch/scroll to zoom ‚Ä¢ Click features for details</div>
      <div class="attribution">
        Data/tiles subject to provider availability. Always follow local officials & NWS guidance.
      </div>
    </section>

    <!-- About -->
    <section class="card" style="grid-column: 1 / -1;">
      <h2>About Desert Viber</h2>
      <div class="panel">
        <p><strong>Real-time severe weather coverage</strong> with interactive radar, watches & warnings,
        and clear, calm explanations ‚Äî with a dash of storm-chaser energy and a cozy community vibe.</p>
        <ul class="list-clean">
          <li>‚úîÔ∏è US-wide composite radar with smooth animation</li>
          <li>‚úîÔ∏è Live National Weather Service alerts by your location</li>
          <li>‚úîÔ∏è Educational breakdowns: how to read radar and track storms</li>
        </ul>
      </div>
    </section>

    <section class="card" id="support" style="grid-column: 1 / -1;">
      <h2>Support & Updates</h2>
      <div class="panel">
        <p>Enjoying the stream? Subscribes & shares help a ton. Consider leaving a üëç on the live chat!</p>
        <form onsubmit="event.preventDefault(); alert('Thanks! This is a placeholder ‚Äî connect your provider form here.');">
          <label class="muted">Get severe weather emails for your state:</label><br/>
          <input type="email" required placeholder="you@example.com" />
          <select>
            <option value="">Select state‚Ä¶</option>
            <option>AL</option><option>AK</option><option>AZ</option><option>AR</option><option>CA</option><option>CO</option>
            <option>CT</option><option>DE</option><option>FL</option><option>GA</option><option>HI</option><option>ID</option>
            <option>IL</option><option>IN</option><option>IA</option><option>KS</option><option>KY</option><option>LA</option>
            <option>ME</option><option>MD</option><option>MA</option><option>MI</option><option>MN</option><option>MS</option>
            <option>MO</option><option>MT</option><option>NE</option><option>NV</option><option>NH</option><option>NJ</option>
            <option>NM</option><option>NY</option><option>NC</option><option>ND</option><option>OH</option><option>OK</option>
            <option>OR</option><option>PA</option><option>RI</option><option>SC</option><option>SD</option><option>TN</option>
            <option>TX</option><option>UT</option><option>VT</option><option>VA</option><option>WA</option><option>WV</option><option>WI</option><option>WY</option>
          </select>
          <button class="btn accent" type="submit">Sign up</button>
        </form>
      </div>
    </section>
  </main>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // --- Map ---
    const map = L.map('map', { zoomControl: true }).setView([39.5, -98.35], 4); // US center
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 10, attribution: '&copy; OpenStreetMap'
    }).addTo(map);

    // RainViewer radar tiles (keep attribution per their terms)
    const radar = L.tileLayer('https://tilecache.rainviewer.com/v2/radar/{z}/{x}/{y}/2/1_1.png', {
      opacity: 0.8, zIndex: 3, attribution: 'Radar ¬© RainViewer'
    }).addTo(map);

    // --- Alerts (NWS CAP API) ---
    const alertsList = document.getElementById('alertsList');
    let alertLayer = L.geoJSON(null, {
      style: f => ({ color:'#ff4d4f', weight:2, fill:false }),
      onEachFeature: (f, layer) => {
        const p = f.properties || {};
        const t = p.event || 'Alert';
        const a = p.areaDesc || '';
        const s = p.severity || '';
        const e = p.effective ? new Date(p.effective).toLocaleString() : '';
        layer.bindPopup(`<strong>${t}</strong><br>${a}<br><em>${s}</em><br>${e}`);
      }
    }).addTo(map);

    async function loadAlerts(params = {}) {
      alertsList.innerHTML = '<div class="muted">Loading alerts‚Ä¶</div>';
      try {
        let url = 'https://api.weather.gov/alerts/active?';
        if (params.point) {
          url += `point=${params.point.lat},${params.point.lon}`;
        } else if (params.area) {
          url += `area=${encodeURIComponent(params.area)}`;
        } else {
          url += 'status=actual&message_type=alert';
        }
        url += '&limit=200';

        const res = await fetch(url, { headers: { 'Accept': 'application/geo+json' }});
        const geo = await res.json();

        if (!geo.features || !geo.features.length) {
          alertsList.innerHTML = '<div class="muted">No active alerts for the current filter.</div>';
        } else {
          alertsList.innerHTML = '';
          geo.features.forEach(f => {
            const p = f.properties || {};
            const div = document.createElement('div');
            div.className = 'alert';
            div.innerHTML = `
              <div class="alert-title">${p.event || 'Alert'}</div>
              <div class="muted">${p.areaDesc || ''}</div>
              <div class="muted">${p.severity || ''} ‚Ä¢ ${p.urgency || ''}</div>
              <div class="muted">${p.sent ? new Date(p.sent).toLocaleString() : ''}</div>`;
            alertsList.appendChild(div);
          });
        }

        alertLayer.clearLayers();
        alertLayer.addData(geo);
      } catch (e) {
        alertsList.innerHTML = '<div class="muted">Failed to load alerts (NWS API). Try again later.</div>';
        console.error(e);
      }
    }
    loadAlerts();

    // --- ZIP and Geolocation helpers ---
    document.getElementById('applyZip').addEventListener('click', async () => {
      const zip = document.getElementById('zip').value.trim();
      if (!zip) return;
      try {
        const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&countrycodes=us&postalcode=${encodeURIComponent(zip)}`);
        const data = await res.json();
        if (data && data[0]) {
          const { lat, lon } = data[0];
          map.setView([+lat, +lon], 7);
          loadAlerts({ point: { lat:+lat, lon:+lon } });
        }
      } catch (e) { console.error(e); }
    });

    document.getElementById('locate').addEventListener('click', () => {
      if (!navigator.geolocation) return alert('Location not supported.');
      navigator.geolocation.getCurrentPosition(pos => {
        const { latitude: lat, longitude: lon } = pos.coords;
        map.setView([lat, lon], 7);
        loadAlerts({ point: { lat, lon } });
      });
    });

    // --- Region quick views ---
    const regionViews = {
      west:   { lat: 37.8, lon: -120.0, zoom: 5 },
      central:{ lat: 38.5, lon:  -96.8, zoom: 5 },
      east:   { lat: 38.8, lon:  -78.5, zoom: 5 },
      alaska: { lat: 64.8, lon: -150.0, zoom: 4 },
      hawaii: { lat: 20.7, lon: -157.5, zoom: 7 }
    };
    document.querySelectorAll('button[data-view]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const v = regionViews[btn.dataset.view];
        if (!v) return;
        map.setView([v.lat, v.lon], v.zoom);
      });
    });

    // --- Subscribe Gate logic (class-based, robust) ---
    (function() {
      const GATE_KEY = 'subGateDismissedAt';
      const SHOW_FOR_HOURS = 24; // set 0 to show every visit
      const gate = document.getElementById('subGate');
      const continueBtn = document.getElementById('continueBtn');

      function lockUI(){ document.body.classList.add('gated'); ['header','main'].forEach(sel=>document.querySelector(sel)?.classList.add('gated')); }
      function unlockUI(){ document.body.classList.remove('gated'); ['header','main'].forEach(sel=>document.querySelector(sel)?.classList.remove('gated')); }
      function shouldShow(){
        try { const ts = +localStorage.getItem(GATE_KEY) || 0; return ((Date.now()-ts)/36e5) >= SHOW_FOR_HOURS; }
        catch { return true; }
      }
      function showGate(){ if(gate){ gate.classList.add('is-open'); lockUI(); } }
      function hideGate(){ if(gate){ gate.classList.remove('is-open'); unlockUI(); try{ localStorage.setItem(GATE_KEY, String(Date.now())); }catch{} } }

      window.addEventListener('DOMContentLoaded', () => { if (shouldShow()) showGate(); });
      continueBtn?.addEventListener('click', (e) => { e.preventDefault(); hideGate(); });

      // Optional: Exit-intent nudge (desktop)
      let exitShown=false;
      window.addEventListener('mouseout', (e) => {
        if (exitShown || gate.classList.contains('is-open')) return;
        if (e.clientY <= 0 || e.clientY < 8) { if (shouldShow()) { showGate(); exitShown=true; } }
      });
    })();
  </script>
</body>
</html>
