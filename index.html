<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Purple Jellyfish Productions — Live US Radar & NWS Alerts</title>

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" rel="stylesheet">
  <script src="https://apis.google.com/js/platform.js" async defer></script>

  <meta name="description" content="Live US radar & NWS alerts + real-time severe weather coverage on YouTube. Subscribe to Purple Jellyfish Productions!" />
  <meta property="og:title" content="Purple Jellyfish Productions — Live US Weather Radar & Alerts" />
  <meta property="og:description" content="Interactive radar, live alerts, and a 24/7 weather stream. Subscribe to support the channel!" />
  <meta property="og:type" content="website" />
  <meta name="twitter:card" content="summary_large_image" />

  <style>
    /* === Brand / Theme === */
    :root {
      --bg:#0b0d12; --fg:#f2f5f9; --muted:#9aa4b2;
      --brand1:#7c3aed; /* jellyfish purple */
      --brand2:#06b6d4; /* sea teal */
      --brand3:#a78bfa; /* soft violet */
      --accent: var(--brand2);
      --danger:#ff4d4f;
    }

    /* Base layout */
    body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto; background:var(--bg); color:var(--fg); }
    header { position:relative; padding:16px 20px; display:flex; gap:12px; flex-wrap:wrap; align-items:center; justify-content:space-between; border-bottom:1px solid #1a222f; }
    .brand { font-weight:700; letter-spacing:.3px; display:flex; align-items:center; gap:10px; }
    .cta { display:flex; gap:8px; flex-wrap:wrap; }
    .btn { background:#141a24; color:var(--fg); border:1px solid #1f2a3a; padding:8px 12px; border-radius:8px; text-decoration:none; cursor:pointer; }
    .btn.accent { border-color: var(--accent); }
    .btn.danger { border-color: var(--danger); }
    .grid { display:grid; grid-template-columns: 1fr; gap:16px; padding:16px; }
    @media(min-width: 980px){ .grid { grid-template-columns: 2fr 1fr; } }
    .card { background:#0f141d; border:1px solid #182233; border-radius:12px; overflow:hidden; }
    .card h2 { margin:0; padding:12px 14px; font-size:1rem; border-bottom:1px solid #182233; color:#e8eef7; display:flex; align-items:center; gap:8px; }
    .video-wrap { position:relative; padding-top:56.25%; }
    .video-wrap iframe { position:absolute; inset:0; width:100%; height:100%; border:0; }
    #map { width:100%; height:560px; }
    .panel { padding:12px 14px; }
    .muted { color:var(--muted); font-size:.9rem; }
    .alerts-list { display:flex; flex-direction:column; gap:10px; max-height:520px; overflow:auto; padding:12px; }
    .alert { border:1px solid #24334a; border-left:4px solid var(--danger); border-radius:8px; padding:10px 12px; background:#0d131b; }
    .alert-title { font-weight:600; }
    .controls { display:flex; gap:8px; flex-wrap:wrap; margin:10px 0 0; }
    input, select { background:#0b1118; color:var(--fg); border:1px solid #1f2a3a; border-radius:8px; padding:8px 10px; }
    .legend { position:absolute; bottom:12px; right:12px; background:#0b1118cc; color:#e8eef7; padding:8px 10px; border-radius:8px; border:1px solid #1f2a3a; font-size:.85rem; }
    .attribution { padding:10px 14px; font-size:.8rem; color:var(--muted); border-top:1px solid #182233; }

    /* ===== Animated Background Gradient ===== */
    .bg {
      position:fixed; inset:-20% -20% -20% -20%; z-index:-1;
      background:
        radial-gradient(40% 35% at 20% 25%, rgba(124,58,237,.18) 0%, transparent 60%),
        radial-gradient(45% 40% at 80% 20%, rgba(6,182,212,.16) 0%, transparent 60%),
        radial-gradient(55% 45% at 60% 80%, rgba(167,139,250,.14) 0%, transparent 60%),
        linear-gradient(180deg, #0b0d12 0%, #0d1020 100%);
      filter: blur(18px) saturate(110%);
      animation: floatGlow 22s ease-in-out infinite alternate;
    }
    @keyframes floatGlow {
      0%   { transform: translate3d(0,0,0) scale(1);   opacity:.9; }
      50%  { transform: translate3d(-1.5%,1%,0) scale(1.02); opacity:.95; }
      100% { transform: translate3d(1.5%,-1%,0) scale(1);  opacity:.9; }
    }

    /* ===== Header Glow (subtle, animated underline) ===== */
    header.header-glow::after{
      content:""; position:absolute; left:0; right:0; bottom:-1px; height:2px;
      background: linear-gradient(90deg, transparent 0%,
                  var(--brand1) 20%, var(--brand2) 50%, var(--brand3) 80%,
                  transparent 100%);
      opacity:.55;
      filter: blur(.3px);
      animation: glowSweep 6s linear infinite;
      background-size: 200% 100%;
    }
    @keyframes glowSweep { 0%{background-position:0% 0;} 100%{background-position:200% 0;} }

    /* Sticky subscribe bar (with intro animation) */
    .subbar{
      position:sticky; top:0; z-index:999; background:#0b1118cc;
      backdrop-filter: saturate(120%) blur(4px);
      border-bottom:1px solid #1f2a3a; padding:8px 12px;
      display:flex; gap:12px; align-items:center; justify-content:center;
      opacity:0; transform:translateY(-8px); transition:opacity .4s ease,transform .4s ease;
    }
    .subbar.is-in{opacity:1; transform:translateY(0);}
    .subbar .note{color:#c6d0de;font-size:.9rem}

    /* ===== Subscribe Gate (fade/slide) ===== */
    .gate-overlay{display:none; position:fixed; inset:0; background:rgba(5,8,12,.86); align-items:center; justify-content:center; z-index:9999; opacity:0;}
    .gate-overlay.is-open{display:flex; animation:gateFade .25s ease forwards;}
    @keyframes gateFade{to{opacity:1;}}
    .gate-modal{
      width:min(680px,92vw); background:#0f141d; border:1px solid #1f2a3a; border-radius:14px;
      box-shadow:0 10px 38px rgba(0,0,0,.45); padding:22px;
      opacity:0; transform:translateY(6px) scale(.98);
    }
    .gate-overlay.is-open .gate-modal{animation:modalIn .3s cubic-bezier(.2,.6,.2,1) .05s forwards;}
    @keyframes modalIn{to{opacity:1; transform:translateY(0) scale(1);}}
    @media (prefers-reduced-motion:reduce){
      .subbar{transition:none; opacity:1; transform:none;}
      .gate-overlay,.gate-modal{animation:none!important; opacity:1; transform:none;}
      .bg{animation:none;}
      header.header-glow::after{animation:none;}
    }

    .gate-modal h3{margin:0 0 8px;font-size:1.25rem;color:#e8eef7}
    .gate-modal p{margin:0 0 14px;color:#c6d0de}
    .gate-actions{display:flex;gap:10px;align-items:center;margin-top:14px;flex-wrap:wrap}
    .gate-btn{background:#141a24;color:#f2f5f9;border:1px solid #1f2a3a;padding:10px 14px;border-radius:10px;cursor:pointer;text-decoration:none}
    .gate-btn.primary{border-color:var(--accent)}
    body.gated{overflow:hidden}
    main.gated,header.gated{pointer-events:none;user-select:none;filter:blur(1px)}
    .list-clean{list-style:none;padding-left:0;margin:0;display:grid;gap:8px}
    .pill{display:inline-block;padding:4px 10px;border:1px solid #24334a;border-radius:999px;font-size:.85rem;color:#c6d0de}

    /* ===== LIVE NOW badge ===== */
    .live-badge{
      display:inline-flex; align-items:center; gap:.45rem;
      background:#141a24; border:1px solid #2a3448; color:#ff7070;
      padding:.22rem .55rem; border-radius:999px; font-weight:700; font-size:.78rem; letter-spacing:.3px;
    }
    .live-dot{
      width:.52rem; height:.52rem; border-radius:999px; background:#ff3b3b;
      box-shadow:0 0 0 0 rgba(255,59,59,.7); animation:pulse 1.4s infinite;
    }
    @keyframes pulse {
      0% { box-shadow:0 0 0 0 rgba(255,59,59,.7); transform:scale(1); }
      70%{ box-shadow:0 0 0 10px rgba(255,59,59,0); transform:scale(1.05); }
      100% { box-shadow:0 0 0 0 rgba(255,59,59,0); transform:scale(1); }
    }
    .live-toggle{ font-size:.8rem; color:#9aa4b2; text-decoration:underline; cursor:pointer; }
  </style>
</head>
<body>

  <!-- Animated background layer -->
  <div class="bg" aria-hidden="true"></div>

  <!-- Subscribe Gate -->
  <div id="subGate" class="gate-overlay" role="dialog" aria-modal="true" aria-labelledby="gateTitle" aria-describedby="gateDesc">
    <div class="gate-modal">
      <h3 id="gateTitle">Support the Stream — Subscribe to Purple Jellyfish Productions</h3>
      <p id="gateDesc">This project runs on your support. Tap subscribe below, then continue to the live radar & alerts.</p>
      <div class="g-ytsubscribe" data-channelid="UCthm4CvoVE0kvHYszkORckg" data-layout="full" data-theme="dark" data-count="default"></div>
      <div class="gate-actions">
        <a class="gate-btn" href="https://www.youtube.com/@purplejellyfishproductions" target="_blank" rel="noopener">Open channel</a>
        <button class="gate-btn primary" id="continueBtn" type="button">I Subscribed — Continue</button>
      </div>
      <p class="muted" style="margin-top:8px;">(We can’t verify a subscription automatically, but every sub helps. Thank you!)</p>
    </div>
  </div>

  <header class="header-glow">
    <div class="brand">
      <img src="logo.png" alt="Purple Jellyfish logo" style="width:34px;height:34px;border-radius:8px;border:1px solid #1f2a3a;object-fit:cover;">
      <span>Purple Jellyfish Productions — Live Radar & Alerts</span>
    </div>
    <div class="cta">
      <a class="btn accent" href="https://www.youtube.com/@purplejellyfishproductions" target="_blank" rel="noopener">Watch on YouTube</a>
      <a class="btn" href="#alerts">View Alerts</a>
      <a class="btn danger" href="#support">Support the Stream</a>
    </div>
  </header>

  <div class="subbar">
    <span class="note">Enjoying the radar & alerts? Subscribe to support the channel:</span>
    <div class="g-ytsubscribe" data-channelid="UCthm4CvoVE0kvHYszkORckg" data-layout="default" data-theme="dark" data-count="default"></div>
    <a class="btn accent" href="https://www.youtube.com/@purplejellyfishproductions" target="_blank" rel="noopener">Open Channel</a>
  </div>

  <main class="grid">
    <section class="card">
      <h2>
        Live Stream
        <span id="liveBadge" class="live-badge" hidden>
          <span class="live-dot" aria-hidden="true"></span> LIVE NOW
        </span>
      </h2>
      <div class="video-wrap">
        <iframe
          src="https://www.youtube.com/embed/1xCAGP_FvNU?autoplay=0&modestbranding=1&rel=0"
          title="YouTube live"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          allowfullscreen></iframe>
      </div>
      <div class="attribution">
        Tip: click “View Alerts” to see active NWS alerts and pan the map to your area.
        &nbsp;|&nbsp; <span id="liveToggle" class="live-toggle" hidden>Not live? Hide badge</span>
        <span id="liveShow" class="live-toggle" hidden>Show LIVE badge</span>
      </div>
    </section>

    <aside class="card" id="alerts">
      <h2>Active Weather Alerts (NWS)</h2>
      <div class="panel">
        <div class="muted">Filter by your area:</div>
        <div class="controls">
          <input id="zip" placeholder="ZIP code (e.g., 80903)" />
          <button class="btn" id="locate">Use my location</button>
          <button class="btn" id="applyZip">Go</button>
        </div>
      </div>
      <div class="alerts-list" id="alertsList"><div class="muted">Loading alerts…</div></div>
      <div class="attribution">Alerts: National Weather Service API • Radar: RainViewer tiles • Map: © OpenStreetMap contributors</div>
    </aside>

    <section class="card" style="grid-column:1 / -1;">
      <h2>Interactive Radar</h2>
      <div class="panel" style="display:flex;gap:8px;flex-wrap:wrap;align-items:center;">
        <span class="muted">Quick view:</span>
        <button class="btn" data-view="west">West</button>
        <button class="btn" data-view="central">Central</button>
        <button class="btn" data-view="east">East</button>
        <button class="btn" data-view="alaska">Alaska</button>
        <button class="btn" data-view="hawaii">Hawaii</button>
      </div>
      <div id="map"></div>
      <div class="legend">Radar intensity ↑ • Use pinch/scroll to zoom • Click features for details</div>
    </section>

    <section class="card" style="grid-column:1 / -1;">
      <h2>About Purple Jellyfish Productions</h2>
      <div class="panel">
        <p><strong>Real-time severe weather coverage</strong> with interactive radar, watches & warnings,
        and clear, calm explanations — with a dash of storm-chaser energy and a cozy community vibe.</p>
      </div>
    </section>

    <section class="card" id="support" style="grid-column:1 / -1;">
      <h2>Support & Updates</h2>
      <div class="panel"><p>Enjoying the stream? Subscribes & shares help a ton. Consider leaving a 👍 on the live chat!</p></div>
    </section>
  </main>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // Sticky bar intro
    window.addEventListener('DOMContentLoaded',()=>{document.querySelector('.subbar')?.classList.add('is-in');});

    // Map + Radar
    const map=L.map('map',{zoomControl:true}).setView([39.5,-98.35],4);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:10}).addTo(map);
    L.tileLayer('https://tilecache.rainviewer.com/v2/radar/{z}/{x}/{y}/2/1_1.png',{opacity:.8,zIndex:3}).addTo(map);

    // Alerts
    const alertsList=document.getElementById('alertsList');
    let alertLayer=L.geoJSON(null,{style:f=>({color:'#ff4d4f',weight:2}),onEachFeature:(f,l)=>{const p=f.properties||{};l.bindPopup(`<strong>${p.event||'Alert'}</strong><br>${p.areaDesc||''}`)}}).addTo(map);

    async function loadAlerts(p={}) {
      alertsList.innerHTML='<div class="muted">Loading alerts…</div>';
      let u='https://api.weather.gov/alerts/active?status=actual&message_type=alert&limit=200';
      if(p.point) u+=`&point=${p.point.lat},${p.point.lon}`;
      const r=await fetch(u,{headers:{'Accept':'application/geo+json'}});
      const g=await r.json();
      alertLayer.clearLayers(); alertLayer.addData(g);
      alertsList.innerHTML = g.features?.length
        ? g.features.map(f=>`<div class="alert">${f.properties.event}</div>`).join('')
        : '<div class="muted">No active alerts.</div>';
    }
    loadAlerts();

    // ZIP + Geolocation
    document.getElementById('applyZip').addEventListener('click', async () => {
      const zip=document.getElementById('zip').value.trim(); if(!zip) return;
      try{
        const res=await fetch(`https://nominatim.openstreetmap.org/search?format=json&countrycodes=us&postalcode=${encodeURIComponent(zip)}`);
        const data=await res.json();
        if(data && data[0]){const {lat,lon}=data[0]; map.setView([+lat,+lon],7); loadAlerts({point:{lat:+lat,lon:+lon}});}
      }catch(e){console.error(e);}
    });
    document.getElementById('locate').addEventListener('click', ()=>{
      if(!navigator.geolocation) return alert('Location not supported.');
      navigator.geolocation.getCurrentPosition(pos=>{
        const {latitude:lat,longitude:lon}=pos.coords;
        map.setView([lat,lon],7); loadAlerts({point:{lat,lon}});
      });
    });

    // Region presets
    const regionViews={west:{lat:37.8,lon:-120,zoom:5},central:{lat:38.5,lon:-96.8,zoom:5},east:{lat:38.8,lon:-78.5,zoom:5},alaska:{lat:64.8,lon:-150,zoom:4},hawaii:{lat:20.7,lon:-157.5,zoom:7}};
    document.querySelectorAll('button[data-view]').forEach(b=>b.addEventListener('click',()=>{const v=regionViews[b.dataset.view]; if(v) map.setView([v.lat,v.lon],v.zoom);}))

    // Subscribe Gate (class-based)
    (function(){
      const KEY='subGateDismissedAt', HOURS=24, gate=document.getElementById('subGate'), btn=document.getElementById('continueBtn');
      const show=()=>{gate.classList.add('is-open');};
      const hide=()=>{gate.classList.remove('is-open'); try{localStorage.setItem(KEY, String(Date.now()));}catch{}};
      const should=()=>{try{const ts=+localStorage.getItem(KEY)||0; return ((Date.now()-ts)/36e5)>=HOURS;}catch{return true}};
      window.addEventListener('DOMContentLoaded', ()=>{ if(should()) show(); });
      btn.addEventListener('click', hide);
    })();

    // LIVE NOW badge logic (URL param or localStorage can hide it)
    (function(){
      const BADGE_KEY='liveBadgeOffUntil';
      const badge=document.getElementById('liveBadge');
      const hideLink=document.getElementById('liveToggle');
      const showLink=document.getElementById('liveShow');

      function showBadge(){ badge.hidden=false; hideLink.hidden=false; showLink.hidden=true; }
      function hideBadge(hours=6){
        badge.hidden=true; hideLink.hidden=true; showLink.hidden=false;
        try{ localStorage.setItem(BADGE_KEY, String(Date.now() + hours*3600*1000)); }catch{}
      }
      function offActive(){
        try{
          const until=+localStorage.getItem(BADGE_KEY)||0;
          return Date.now() < until;
        }catch{ return false; }
      }

      // URL override: ?live=0 hides; ?live=1 forces show
      const q=new URLSearchParams(location.search);
      const liveParam=q.get('live');
      const forceOn=liveParam==='1';
      const forceOff=liveParam==='0';

      window.addEventListener('DOMContentLoaded', ()=>{
        if (forceOn) { showBadge(); return; }
        if (forceOff || offActive()) { hideBadge(0); return; }
        showBadge();
      });

      hideLink.addEventListener('click', ()=> hideBadge(6) );
      showLink.addEventListener('click', ()=> { try{localStorage.removeItem(BADGE_KEY);}catch{}; showBadge(); });
    })();
  </script>
</body>
</html>
